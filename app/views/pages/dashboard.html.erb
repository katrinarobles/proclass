<div class="header-container">
  <h1> Welcome <%= current_user.first_name.split(" ").first.capitalize %>,</h1>
  <p> This is your dashboard</p>
</div>

<div class="main-container">
  <div class="split-cards1 cards">
      <p>Name: <strong> <%= current_user.first_name.split(" ").first.capitalize %>
          <%= current_user.last_name.split(" ").first.capitalize %> </strong></p>
      <p>Phone: <%= current_user.phone %></p>
      <p>Email: <%= current_user.email %></p>
      <p><%= link_to 'Update Your Account', edit_user_registration_path %></p>

      <% if current_user.teacher? %>
        <p>Title: <strong>Teacher</strong></p>
        <p><%= link_to 'Create a Course', new_course_path, class: "btn btn-primary" %></p>
    </div>

    <div class="registered-class cards">
        <p>Your list of courses: <% current_user.courses.each do |course| %> </p>
        <div class="teacher-cards">
          <div class="course-part">
            <p><%= link_to course.name, course_path(course), class: "btn btn-ghost" %></p>
          </div>
          <div class="to-do-part">
            <%= link_to new_course_occurence_path(course.id) do %> <i aria-hidden="true" class="far fa-calendar-plus" title="add event"></i> <% end %>
            || <%= link_to course_occurences_path(course) do %> <i class="far fa-folder-open" title="see old records"></i> <% end %>
            || <%= link_to edit_course_path(course) do %><i class="far fa-edit" title="edit course"></i> <% end %>
            || <%= link_to course_path(course), method: :delete, data: { confirm: "Are you sure? Deleting the course will delete all events affiliated " } do %> <i class="far fa-trash-alt" title="delete course"></i> <% end %>
          </div>
        </div>
        <% end %>
    </div>

    <div class="registered-class cards">
      Classes You've Registered:
      <table>
        <tr>
          <th>
            <%= sort_link(@q, :occurence_date,  default_order: { occurence_date: 'asc'}) do %>
              <small>(sort by date)</small>
            <% end %>
          </th>
          <th>
            <%= sort_link(@q, :user_last_name,  default_order: { user_last_name: 'asc'}) do %>
            <small>(sort by teacher) </small>
            <% end %>
          </th>

        </tr>
        <% if @bookings.exists? %>
          <% @bookings.each do |booking| %>
          <% if Time.parse(booking.occurence.date) > Time.now %>
          <tr>
            <td>
              <p><strong><%= link_to booking.occurence.dateparse.strftime("%^a, %e %^b %H:%M"), course_occurence_path(booking.course, booking.occurence) %></strong>
                <small>
                  - <%= link_to booking.course.name, course_path(booking.course) %>
                </small>
            </td>
            <td>
              <small>
                <%= link_to booking.course.teacher, user_path(booking.course.user.username) %>
                || <%= link_to course_occurence_booking_path(booking.course.id, booking.occurence.id, booking), method: :delete, data: { confirm: "Are you sure you'd like to cancel?" } do %> <i class="far fa-trash-alt"></i> <% end %></p>
                </small>
            </td>
          </tr>
          <% end %>
          <% end %>
        <% end %>
      </table>
    </div>

    <!-- Student's DASHBOARD -->

  <% else %>
      <p><%= link_to 'Find a Class', courses_path, class: "btn btn-primary" %></p>
    </div>

    <div class="split-cards2 cards">
        <table>
        <tr>
          <th>
            <%= sort_link(@q, :occurence_date) do %>
              Classes You've Registered: <small> (sort by date)</small>
            <% end %>
          </th>
        </tr>
        <% if @bookings.exists? %>
          <% @bookings.each do |booking| %>
          <% if Time.parse(booking.occurence.date) > Time.now %>
          <tr>
            <td>
              <p><strong><%= link_to booking.occurence.dateparse.strftime("%^a, %e %^b %H:%M"), course_occurence_path(booking.course, booking.occurence) %></strong>
                <small>
                  - <%= link_to booking.course.name, course_path(booking.course) %> with <%= link_to booking.course.teacher, user_path(booking.course.user.username) %>
                  || <%= link_to course_occurence_booking_path(booking.course.id, booking.occurence.id, booking), method: :delete, data: { confirm: "Are you sure you'd like to cancel?" } do %> <i class="far fa-trash-alt"></i> <% end %></p>
                </small>
            </td>
          </tr>
          <% end %>
          <% end %>
        <% end %>
      </table>
  <% end %>
    </div>
</div>




<div class="users-show-container">
    <h2> Your Schedule Coming Up </h2>
    <%= calendar(number_of_days: 3) do |date| %>
      <%= date.day %>
      <% @bookings.each do |booking| %>
        <% if booking.occurence.date.to_datetime.to_date == date %>
          <div class='calendar-card'>
            <% if Time.parse(booking.occurence.date) < Time.now %>
              Attended:
              <br><%= link_to booking.occurence.course.name, course_occurence_path(booking.occurence.course, booking.occurence) %>
              <br><strong><%= booking.occurence.dateparse.strftime("%H:%M") %></strong>
              <p><i class="fas fa-running"></i></p>
            <% else %>
              Attending:
              <br><%= link_to booking.occurence.course.name, course_occurence_path(booking.occurence.course, booking.occurence) %>
              <br><strong><%= booking.occurence.dateparse.strftime("%H:%M") %></strong>
            <% end %>
          </div>
        <% end %>
      <% end %>
      <% current_user.courses.each do |course| %>
        <% course.occurences.each do |occurence| %>
            <% if occurence.date.to_datetime.to_date == date %>
              <div class='calendar-card teaching'>
                <% if Time.parse(occurence.date) < Time.now %>
                  <strong>Taught:</strong>
                  <br><%= link_to occurence.course.name, course_occurence_path(occurence.course, occurence) %>
                  <br><strong><%= occurence.dateparse.strftime("%H:%M") %></strong>
                  <br><i class="fas fa-users"></i> <%= occurence.users.count %>/<%= occurence.capacity %>
                <% else %>
                  <strong>Teaching:</strong>
                  <br><%= link_to occurence.course.name, course_occurence_path(occurence.course, occurence) %>
                  <br><strong><%= occurence.dateparse.strftime("%H:%M") %></strong>
                  <br><i class="fas fa-users"></i> <%= occurence.users.count %>/<%= occurence.capacity %>
                <% end %>
            <% end %>
        <% end %>
      <% end %>
    <% end %>
</div>
