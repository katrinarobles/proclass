<div class="header-container">
    <% if !user_signed_in? %>
      <h1>Welcome to ProClass,</h1>
      <p> a fancy scheduling management system for fitness instructors like yourself so your clients can easily connect to you and your classes!</p>
        <p><%= link_to 'Login', new_user_session_path, class: 'btn btn-primary' %>
        <%= link_to "Sign Up", new_user_registration_path, class: 'btn btn-sign-up' %></p>
      <% end %>

      <p><%= link_to courses_path, class: 'btn btn-search' do %>
        SEARCH <i class="fas fa-search"></i>
        <% end %></p>
        <h2> Classes Happening Now!</h2>
    </div>

  <div class="home-container">
    <div class="cards-container">
    <% @occurences.each do |occurence| %>
        <div id="event-link" data-occurence="<%= @markers.select{ |marker| marker[:id] == occurence.id }.to_json %>" class="occurence-home-cards home-card">
            <div class="photo-card">
                <%= link_to course_path(occurence.course) do %>
                    <%= cl_image_tag occurence.course.photo.key, class: 'home-photo-card'%>
                <% end %>
            </div>

            <div class="cardy-body">
                    <h5><%= occurence.course.name %></h5>
                    <p><small><%= link_to occurence.course.teacher, user_path(occurence.course.user.username) %>
                    <br><strong><%= link_to occurence.dateparse.strftime("%^a, %e %^b %H:%M"), course_occurence_path(occurence.course, occurence) %></strong>
                    <br><%= occurence.online? ? 'ONLINE' : " " %>
                    <br><%= occurence.location? ? occurence.location.first(25) : " " %></small></p>
            </div>
            <div class="links-card">
                <% if user_signed_in? %>
                    <% if current_user == occurence.course.user %>
                                <%= link_to edit_course_occurence_path(occurence.course, occurence) do %><i class="far fa-edit"></i> <% end %>
                    <% elsif occurence.capacity == occurence.users.count %>
                        Full
                    <% elsif current_user.bookings.where(occurence_id: occurence.id).first %>
                        <small><strong>Already Booked</strong></small>
                        <%= link_to 'Cancel?', course_occurence_booking_path(occurence.course.id, occurence.id, current_user.bookings.where(occurence_id: occurence.id).first), method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-clear' %>
                    <% else %>
                            <small><%= link_to "Book", course_occurence_bookings_path(occurence.course.id, occurence.id), method: :post, class: "btn-primary-small" %></small>
                    <% end %>
                <% else %>
                    <p><%= link_to "Login", new_user_session_path, class: 'btn btn-primary' %></p>
                    <p><%= link_to "Sign Up", new_user_registration_path, class: 'btn btn-sign-up' %></p>
                <% end %>
            </div>
        </div>
    <% end %>
    </div>

    <div class="map-cardy" style="height: 70vh; top: 0; position: sticky;">

        <div id="map"
             style="width: 100%; height: 70vh; object-fit: cover;"
             data-markers="<%= @markers.to_json %>"
             data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"> </div>
        <div class="header-container">
            <p><%= link_to courses_path, class: 'btn btn-search padbttm' do %>
                SEARCH FOR MORE CLASSES<i class="fas fa-search"></i>
                <% end %>
            </p>
        </div>
    </div>
  </div>
</div>
